{% extends "base.html" %}
{% block title %}Admin Dashboard{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='style/admin_dashboard.css') }}">
{% endblock %}

{% block content %}
<div class="container">
    <!-- Dashboard Header -->
    <div class="dashboard-header">
        <h1>Welcome, Admin {{ session.username }}</h1>
        <p>Manage your Job Sansar platform efficiently</p>
    </div>

    <!-- Admin Actions -->
    <div class="admin-actions">
        <a href="{{ url_for('admin.view_feedback') }}" class="btn btn-primary">
            üìã View Feedback
        </a>
    </div>

    <!-- Statistics Cards -->
    <div class="stats-cards">
        <div class="stat-card">
            <h3>Total Users</h3>
            <p class="stat-number">{{ users|length }}</p>
        </div>
        <div class="stat-card">
            <h3>Total Jobs</h3>
            <p class="stat-number">{{ jobs|length }}</p>
        </div>
        <div class="stat-card">
            <h3>Total CVs</h3>
            <p class="stat-number">{{ cvs|length }}</p>
        </div>
    </div>

    <!-- Users Management Section -->
    <h2 class="section-header">Users Management</h2>
    <div class="table-container">
        <table class="table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Username</th>
                    <th>Role</th>
                    <th>Address</th>
                    <th>Company Name</th>
                    <th>Created At</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                    <tr>
                        <td>{{ user.id }}</td>
                        <td><strong>{{ user.username }}</strong></td>
                        <td>
                            <span class="role-badge role-{{ user.role|lower }}">
                                {{ user.role }}
                            </span>
                        </td>
                        <td>{{ user.address or 'N/A' }}</td>
                        <td>{{ user.company_name or 'N/A' }}</td>
                        <td>{{ user.created_at.strftime('%Y-%m-%d %H:%M') if user.created_at else 'N/A' }}</td>
                        <td class="action-buttons">
                            {% if user.id != session.get('user_id') %}
                            <form action="{{ url_for('admin.delete_user', user_id=user.id) }}" method="POST" 
                                  onsubmit="return confirm('Are you sure you want to delete user {{ user.username }}? This will also delete all their associated data.');">
                                <button type="submit" class="btn btn-danger">üóëÔ∏è Delete</button>
                            </form>
                            {% else %}
                            <span style="color: #666; font-size: 0.9rem; font-style: italic;">Current User</span>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Job Requirements Section -->
    <h2 class="section-header">Job Requirements</h2>
    <div class="table-container">
        <table class="table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Filename</th>
                    <th>Domain</th>
                    <th>Uploaded by</th>
                    <th>Upload Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for job in jobs %}
                    <tr>
                        <td>{{ job.id }}</td>
                        <td>{{ job.filename }}</td>
                        <td>{{ job.domain or 'N/A' }}</td>
                        <td>{{ job.user.username }}</td>
                        <td>{{ job.upload_date.strftime('%Y-%m-%d %H:%M') if job.upload_date else 'N/A' }}</td>
                        <td class="action-buttons">
                            <form action="{{ url_for('admin.delete_job', job_id=job.id) }}" method="POST" 
                                  onsubmit="return confirm('Are you sure you want to delete this job requirement?');">
                                <button type="submit" class="btn btn-danger">üóëÔ∏è Delete</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Candidate CVs Section -->
    <h2 class="section-header">Candidate CVs</h2>
    <div class="table-container">
        <table class="table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Filename</th>
                    <th>Domain</th>
                    <th>Uploaded by</th>
                    <th>Upload Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for cv in cvs %}
                    <tr>
                        <td>{{ cv.id }}</td>
                        <td>{{ cv.filename }}</td>
                        <td>{{ cv.domain or 'N/A' }}</td>
                        <td>{{ cv.user.username }}</td>
                        <td>{{ cv.upload_date.strftime('%Y-%m-%d %H:%M') if cv.upload_date else 'N/A' }}</td>
                        <td class="action-buttons">
                            <form action="{{ url_for('admin.delete_cv', cv_id=cv.id) }}" method="POST" 
                                  onsubmit="return confirm('Are you sure you want to delete this CV?');">
                                <button type="submit" class="btn btn-danger">üóëÔ∏è Delete</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Logout Button -->
    <div style="text-align: center; margin-top: 2rem;">
        <a href="{{ url_for('admin.logout') }}" class="btn btn-primary" 
           style="background: #6c757d; border: none;">
            üö™ Logout
        </a>
    </div>
</div>
{% endblock %}